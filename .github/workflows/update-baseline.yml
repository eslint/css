name: Update baseline
on:
    workflow_dispatch:
    schedule:
        - cron: "0 0 * * 0" # Runs every Sunday at midnight UTC

jobs:
    update-baseline:
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

        runs-on: ubuntu-latest
        steps:
            # We are using our GitHub Bot App to create the PR.
            # This ensures that other workflows triggered by
            # PR creation will run as expected.
            # The GitHub Bot App is configured in the organization settings.
            - uses: actions/create-github-app-token@v2
              id: generate-token
              with:
                  app-id: ${{ vars.BOT_APP_ID }}
                  private-key: ${{ secrets.BOT_APP_PRIVATE_KEY }}

            - uses: actions/checkout@v5
            - name: Setup Node.js
              uses: actions/setup-node@v6
              with:
                  node-version: "lts/*"

            - name: Install dependencies
              run: npm install

            - name: Update baseline packages
              run: npm install -D mdn-data@latest web-features@latest

            - name: Generate baseline data
              run: npm run build:baseline

            - name: Create Pull Request
              uses: peter-evans/create-pull-request@v7
              with:
                  token: ${{ steps.generate-token.outputs.token }}
                  commit-message: "fix: update baseline data"
                  title: "fix: update baseline data"
                  branch: update-baseline-data
                  branch-suffix: timestamp
                  body: |
                      Updates baseline data using the latest versions of mdn-data and web-features.

                      This PR is autogenerated by the "Update Baseline" GitHub Action.
